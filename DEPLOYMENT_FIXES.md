# ðŸ”§ Stardew Save Manager - éƒ¨ç½²é—®é¢˜ä¿®å¤æŠ¥å‘Š

**ä¿®å¤æ—¶é—´**: 2024-07-11 18:20  
**ä¿®å¤ç‰ˆæœ¬**: v1.1  
**ä¿®å¤è„šæœ¬**: `deploy_fixed.sh`

## ðŸ“‹ å‘çŽ°çš„éƒ¨ç½²é—®é¢˜

### 1. ç½‘ç»œè¿žæŽ¥é—®é¢˜
**é—®é¢˜**: éƒ¨ç½²è„šæœ¬æ²¡æœ‰æ£€æŸ¥ç½‘ç»œè¿žæŽ¥ï¼Œåœ¨ç½‘ç»œä¸å¯ç”¨æ—¶ä¼šå¯¼è‡´ä¸‹è½½å¤±è´¥
**å½±å“**: ä¾èµ–ä¸‹è½½å¤±è´¥ï¼Œéƒ¨ç½²ä¸­æ–­
**ä¿®å¤**: æ·»åŠ ç½‘ç»œè¿žæŽ¥æ£€æŸ¥åŠŸèƒ½

### 2. é”™è¯¯å¤„ç†ä¸å®Œå–„
**é—®é¢˜**: æŸäº›æ­¥éª¤å¤±è´¥æ—¶æ²¡æœ‰é€‚å½“çš„é”™è¯¯å¤„ç†å’Œæ¸…ç†
**å½±å“**: éƒ¨ç½²å¤±è´¥åŽç³»ç»ŸçŠ¶æ€ä¸ä¸€è‡´
**ä¿®å¤**: å¢žå¼ºé”™è¯¯å¤„ç†å’Œæ·»åŠ æ¸…ç†å‡½æ•°

### 3. ç£ç›˜ç©ºé—´æ£€æŸ¥ç¼ºå¤±
**é—®é¢˜**: æ²¡æœ‰æ£€æŸ¥ç£ç›˜ç©ºé—´æ˜¯å¦è¶³å¤Ÿ
**å½±å“**: åœ¨ç©ºé—´ä¸è¶³æ—¶éƒ¨ç½²å¤±è´¥
**ä¿®å¤**: æ·»åŠ ç£ç›˜ç©ºé—´æ£€æŸ¥

### 4. æœåŠ¡å¯åŠ¨éªŒè¯ä¸è¶³
**é—®é¢˜**: æœåŠ¡å¯åŠ¨åŽéªŒè¯ä¸å¤Ÿè¯¦ç»†
**å½±å“**: å¯èƒ½éƒ¨ç½²"æˆåŠŸ"ä½†æœåŠ¡å®žé™…æœªæ­£å¸¸è¿è¡Œ
**ä¿®å¤**: å¢žå¼ºæœåŠ¡éªŒè¯å’Œæ—¥å¿—æŸ¥çœ‹

### 5. ç®¡ç†è„šæœ¬åŠŸèƒ½ä¸è¶³
**é—®é¢˜**: ç¼ºå°‘æ—¥å¿—æŸ¥çœ‹åŠŸèƒ½
**å½±å“**: ç”¨æˆ·éš¾ä»¥è¯Šæ–­é—®é¢˜
**ä¿®å¤**: æ·»åŠ ä¸“é—¨çš„æ—¥å¿—æŸ¥çœ‹è„šæœ¬

## ðŸ”§ ä¿®å¤å†…å®¹è¯¦æƒ…

### æ–°å¢žåŠŸèƒ½

#### 1. ç½‘ç»œè¿žæŽ¥æ£€æŸ¥
```bash
check_network() {
    # æ£€æŸ¥åŸºæœ¬ç½‘ç»œè¿žæŽ¥
    if ! ping -c 1 8.8.8.8 > /dev/null 2>&1; then
        log_error "æ— æ³•è¿žæŽ¥åˆ°äº’è”ç½‘ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè®¾ç½®"
        exit 1
    fi
    
    # æ£€æŸ¥ DNS è§£æž
    if ! nslookup google.com > /dev/null 2>&1; then
        log_error "DNS è§£æžå¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè®¾ç½®"
        exit 1
    fi
}
```

#### 2. ç£ç›˜ç©ºé—´æ£€æŸ¥
```bash
# æ£€æŸ¥ç£ç›˜ç©ºé—´
AVAILABLE_SPACE=$(df / | awk 'NR==2 {print $4}')
REQUIRED_SPACE=5242880  # 5GB in KB

if [[ $AVAILABLE_SPACE -lt $REQUIRED_SPACE ]]; then
    log_error "ç£ç›˜ç©ºé—´ä¸è¶³ï¼Œéœ€è¦è‡³å°‘ 5GB å¯ç”¨ç©ºé—´"
    log_info "å½“å‰å¯ç”¨ç©ºé—´: $((AVAILABLE_SPACE / 1024 / 1024))GB"
    exit 1
fi
```

#### 3. å¢žå¼ºé”™è¯¯å¤„ç†
```bash
# æ¯ä¸ªå…³é”®æ­¥éª¤éƒ½æ·»åŠ äº†é”™è¯¯æ£€æŸ¥
if ! apt update; then
    log_error "æ›´æ–°åŒ…ç®¡ç†å™¨å¤±è´¥"
    exit 1
fi

# æ·»åŠ æ¸…ç†å‡½æ•°
cleanup() {
    log_error "éƒ¨ç½²è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ï¼Œæ­£åœ¨æ¸…ç†..."
    # åœæ­¢æœåŠ¡ã€åˆ é™¤é…ç½®æ–‡ä»¶ç­‰
}
```

#### 4. æœåŠ¡éªŒè¯å¢žå¼º
```bash
verify_deployment() {
    # æ£€æŸ¥åŽç«¯æœåŠ¡
    if supervisorctl status stardew-backend | grep -q "RUNNING"; then
        log_success "åŽç«¯æœåŠ¡è¿è¡Œæ­£å¸¸"
    else
        log_error "åŽç«¯æœåŠ¡å¯åŠ¨å¤±è´¥"
        log_info "æŸ¥çœ‹åŽç«¯æ—¥å¿—:"
        tail -n 20 "$PROJECT_DIR/logs/backend.log" || echo "æ— æ³•è¯»å–æ—¥å¿—æ–‡ä»¶"
        return 1
    fi
}
```

#### 5. æ–°å¢žæ—¥å¿—æŸ¥çœ‹è„šæœ¬
```bash
# åˆ›å»ºæ—¥å¿—æŸ¥çœ‹è„šæœ¬
cat > "$PROJECT_DIR/logs.sh" << 'EOF'
#!/bin/bash
echo "=== Stardew Save Manager æ—¥å¿—æŸ¥çœ‹ ==="
echo "é€‰æ‹©è¦æŸ¥çœ‹çš„æ—¥å¿—:"
echo "1) åŽç«¯æ—¥å¿—"
echo "2) Nginx è®¿é—®æ—¥å¿—"
echo "3) Nginx é”™è¯¯æ—¥å¿—"
echo "4) å®žæ—¶åŽç«¯æ—¥å¿—"
echo "5) å®žæ—¶ Nginx æ—¥å¿—"
# ... äº¤äº’å¼æ—¥å¿—æŸ¥çœ‹åŠŸèƒ½
EOF
```

### ä¿®å¤çš„é—®é¢˜

#### 1. ä¾èµ–å®‰è£…ä¼˜åŒ–
- æ·»åŠ äº† `net-tools` åŒ…å®‰è£…ï¼ˆç”¨äºŽ netstat å‘½ä»¤ï¼‰
- æ”¹è¿›äº† Node.js å®‰è£…çš„é”™è¯¯å¤„ç†
- ä¼˜åŒ–äº† Go ä¸‹è½½å’Œå®‰è£…æµç¨‹

#### 2. ç›®å½•ç»“æž„å®Œå–„
- ç¡®ä¿ `bin` ç›®å½•å­˜åœ¨
- æ”¹è¿›äº†ç›®å½•æƒé™è®¾ç½®
- æ·»åŠ äº†ç›®å½•å­˜åœ¨æ€§æ£€æŸ¥

#### 3. æœåŠ¡é…ç½®ä¼˜åŒ–
- è‡ªåŠ¨ç”Ÿæˆ JWT å¯†é’¥
- æ”¹è¿›äº† Supervisor é…ç½®
- ä¼˜åŒ–äº† Nginx é…ç½®æµ‹è¯•

#### 4. çŠ¶æ€æ£€æŸ¥æ”¹è¿›
- æ·»åŠ äº†ç«¯å£ç›‘å¬æ£€æŸ¥çš„é”™è¯¯å¤„ç†
- æ”¹è¿›äº†æœåŠ¡çŠ¶æ€éªŒè¯
- å¢žåŠ äº†è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯è¾“å‡º

## ðŸ“Š ä¿®å¤å‰åŽå¯¹æ¯”

| åŠŸèƒ½ | ä¿®å¤å‰ | ä¿®å¤åŽ |
|------|--------|--------|
| ç½‘ç»œæ£€æŸ¥ | âŒ æ—  | âœ… å®Œæ•´æ£€æŸ¥ |
| ç£ç›˜ç©ºé—´æ£€æŸ¥ | âŒ æ—  | âœ… 5GB æ£€æŸ¥ |
| é”™è¯¯å¤„ç† | âš ï¸ åŸºç¡€ | âœ… å®Œå–„ |
| æ¸…ç†åŠŸèƒ½ | âŒ æ—  | âœ… è‡ªåŠ¨æ¸…ç† |
| æœåŠ¡éªŒè¯ | âš ï¸ ç®€å• | âœ… è¯¦ç»†éªŒè¯ |
| æ—¥å¿—æŸ¥çœ‹ | âŒ æ—  | âœ… äº¤äº’å¼ |
| é”™è¯¯ä¿¡æ¯ | âš ï¸ ç®€å• | âœ… è¯¦ç»† |

## ðŸš€ ä½¿ç”¨æ–¹æ³•

### ä½¿ç”¨ä¿®å¤ç‰ˆè„šæœ¬
```bash
# ä¸‹è½½é¡¹ç›®
git clone https://github.com/Yeaowo/stardew-save-manager.git
cd stardew-save-manager

# ä½¿ç”¨ä¿®å¤ç‰ˆéƒ¨ç½²è„šæœ¬
sudo ./deploy_fixed.sh
```

### æ–°å¢žç®¡ç†å‘½ä»¤
```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
/opt/stardew-save-manager/status.sh

# æŸ¥çœ‹æ—¥å¿—
/opt/stardew-save-manager/logs.sh

# å…¶ä»–ç®¡ç†å‘½ä»¤
/opt/stardew-save-manager/start.sh
/opt/stardew-save-manager/stop.sh
/opt/stardew-save-manager/restart.sh
```

## ðŸ” æ•…éšœæŽ’é™¤

### å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

#### 1. ç½‘ç»œè¿žæŽ¥é—®é¢˜
```bash
# æ£€æŸ¥ç½‘ç»œè¿žæŽ¥
ping -c 1 8.8.8.8
nslookup google.com

# å¦‚æžœç½‘ç»œæœ‰é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
# - ç½‘ç»œé…ç½®
# - DNS è®¾ç½®
# - é˜²ç«å¢™è§„åˆ™
```

#### 2. ç£ç›˜ç©ºé—´ä¸è¶³
```bash
# æ£€æŸ¥ç£ç›˜ç©ºé—´
df -h /

# æ¸…ç†ç©ºé—´
sudo apt clean
sudo apt autoremove
```

#### 3. æœåŠ¡å¯åŠ¨å¤±è´¥
```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
sudo supervisorctl status stardew-backend
sudo systemctl status nginx

# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
/opt/stardew-save-manager/logs.sh
```

#### 4. ç«¯å£è¢«å ç”¨
```bash
# æ£€æŸ¥ç«¯å£å ç”¨
sudo netstat -tlnp | grep :80
sudo netstat -tlnp | grep :8080

# åœæ­¢å ç”¨ç«¯å£çš„æœåŠ¡
sudo systemctl stop apache2  # å¦‚æžœ Apache å ç”¨ 80 ç«¯å£
```

## âœ… æµ‹è¯•éªŒè¯

### è‡ªåŠ¨éªŒè¯é¡¹ç›®
- âœ… ç½‘ç»œè¿žæŽ¥æ£€æŸ¥
- âœ… ç³»ç»ŸçŽ¯å¢ƒéªŒè¯
- âœ… ä¾èµ–å®‰è£…æµ‹è¯•
- âœ… æœåŠ¡å¯åŠ¨éªŒè¯
- âœ… ç«¯å£ç›‘å¬æ£€æŸ¥
- âœ… HTTP è¿žæŽ¥æµ‹è¯•

### æ‰‹åŠ¨éªŒè¯é¡¹ç›®
- âœ… å‰ç«¯ç•Œé¢è®¿é—®
- âœ… åŽç«¯ API å“åº”
- âœ… ç”¨æˆ·æ³¨å†Œç™»å½•
- âœ… æ–‡ä»¶ä¸Šä¼ ä¸‹è½½
- âœ… æ—¥å¿—è®°å½•åŠŸèƒ½

## ðŸŽ¯ æ”¹è¿›å»ºè®®

### è¿›ä¸€æ­¥ä¼˜åŒ–
1. **æ·»åŠ å›žæ»šåŠŸèƒ½**: éƒ¨ç½²å¤±è´¥æ—¶è‡ªåŠ¨å›žæ»šåˆ°ä¹‹å‰çš„çŠ¶æ€
2. **é…ç½®æ–‡ä»¶å¤‡ä»½**: è‡ªåŠ¨å¤‡ä»½çŽ°æœ‰é…ç½®æ–‡ä»¶
3. **æ€§èƒ½ç›‘æŽ§**: æ·»åŠ ç³»ç»Ÿèµ„æºç›‘æŽ§
4. **è‡ªåŠ¨æ›´æ–°**: æ”¯æŒä¸€é”®æ›´æ–°åŠŸèƒ½

### é•¿æœŸè§„åˆ’
1. **å¤šçŽ¯å¢ƒæ”¯æŒ**: æ”¯æŒå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§çŽ¯å¢ƒ
2. **å®¹å™¨åŒ–éƒ¨ç½²**: ä¼˜åŒ– Docker éƒ¨ç½²æ–¹æ¡ˆ
3. **é›†ç¾¤éƒ¨ç½²**: æ”¯æŒå¤šèŠ‚ç‚¹éƒ¨ç½²
4. **ç›‘æŽ§é›†æˆ**: é›†æˆ Prometheusã€Grafana ç­‰ç›‘æŽ§å·¥å…·

## ðŸŽ‰ æ€»ç»“

ä¿®å¤ç‰ˆéƒ¨ç½²è„šæœ¬ (`deploy_fixed.sh`) è§£å†³äº†åŽŸç‰ˆæœ¬ä¸­çš„ä¸»è¦é—®é¢˜ï¼š

1. **å¯é æ€§æå‡**: æ·»åŠ äº†å®Œæ•´çš„é”™è¯¯æ£€æŸ¥å’Œæ¸…ç†æœºåˆ¶
2. **ç”¨æˆ·ä½“éªŒæ”¹å–„**: æä¾›äº†è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯å’Œæ•…éšœæŽ’é™¤æŒ‡å—
3. **åŠŸèƒ½å¢žå¼º**: æ–°å¢žäº†æ—¥å¿—æŸ¥çœ‹å’Œç®¡ç†åŠŸèƒ½
4. **ç¨³å®šæ€§æé«˜**: æ”¹è¿›äº†æœåŠ¡éªŒè¯å’ŒçŠ¶æ€æ£€æŸ¥

**æŽ¨èä½¿ç”¨ä¿®å¤ç‰ˆè„šæœ¬è¿›è¡Œéƒ¨ç½²ï¼Œä»¥èŽ·å¾—æ›´å¥½çš„éƒ¨ç½²ä½“éªŒå’Œæ›´é«˜çš„æˆåŠŸçŽ‡ã€‚**

---

**ðŸŒ¾ éƒ¨ç½²é—®é¢˜ä¿®å¤å®Œæˆï¼ŒçŽ°åœ¨å¯ä»¥æ›´å®‰å…¨ã€æ›´å¯é åœ°éƒ¨ç½² Stardew Save Managerï¼**